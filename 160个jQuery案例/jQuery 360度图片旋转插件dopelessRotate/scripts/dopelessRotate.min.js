(function(a){var b="ontouchstart"in document.documentElement;a.fn.tsRotate=function(c){function O(a,b){s.find(a).css(b)}function T(b,c){var d=0;var e=0;var f=[];a(b).each(function(){var b=a("<img>").attr("src",this).load(function(){d=d+100/c;N=Math.round(M/100*d);a(s).find(".loading_bar_inside").css("width",N);if(Math.round(d)==100){a(s).find(".loading_bg").fadeOut();a(s).find(".round, .zoom").fadeIn()}});e++;t.attr("src",this);f.push(b)});t.attr("src",b[h]);U()}function U(){var a=Math.floor(360/R)*f;var b=a*h;var c=b*Math.PI/180;var d=Math.sin(c);var e=Math.cos(c);var g=z+A*d*-1;var i=z+A*e;O(".pointer",{left:g,top:i})}function V(a){r.on("mousemove.dragrotate",function(b){var c=b.pageX-w.left;var d=c-a;var e=Math.round(p/R)*f;var g=Math.round(d/e);var j=Math.abs(Math.floor((g+i)/R));h=i+g;if(h>=R){h=h-R*j}if(h<0){h=R*j+h}t.attr("src",P[h]);U()});r.on("mouseup.dragrotate",function(){i=h;r.off(".dragrotate")})}function W(a){s.on("touchmove.dragrotatemob",function(b){var c=window.event;var d=c.touches[0].pageX-w.left;var e=d-a;var g=Math.round(p/R)*f;var j=Math.round(e/g);var k=Math.abs(Math.floor((j+i)/R));h=i+j;if(h>=R){h=h-R*k}if(h<0){h=R*k+h}t.attr("src",P[h]);U()});s.on("touchend.dragrotatemob",function(a){i=h;s.off(".dragrotatemob")})}function X(a,b,c){S=true;var d=true;s.find(".round").fadeOut();s.find(".zoom").fadeOut();var e=new Image;e.src=Q[h];if(e.complete||e.readystate===4){}else{s.find(".zoomload_bg").fadeIn()}e.onload=function(){zoomHeight=e.height;zoomWidth=e.width;var d=(zoomWidth-p)/-2;var f=(zoomHeight-q)/-2;u.attr("src",Q[h]);u.css({left:d,top:f});t.animate({width:zoomWidth,height:zoomHeight,left:d,top:f},100,"linear",function(){u.animate({width:zoomWidth,height:zoomHeight,left:d,top:f},100,"linear",function(){u.fadeIn(100)})});s.find(".zoomload_bg").fadeOut();s.addClass("zoomout");var g=false;s.on("mousemove.dragpan",function(e){var g=e.pageX-c.left;var h=e.pageY-c.top;var i=(zoomWidth-p)*-1;var j=(zoomHeight-q)*-1;var k=Math.floor(zoomWidth/p);var l=Math.floor(zoomHeight/q);var m=a-g;var n=b-h;var o=d+m*k;var r=f+n*l;var s=false;var t=false;if(o>=0){s=true;a=a-o}if(o<=i){s=true;a=a-o+i}if(r>=0){t=true;b=b-r}if(r<=j){t=true;b=b-r+j}if(!s){u.css("left",o)}if(!t){u.css("top",r)}});r.on("mousedown.zoomof",function(){if(!g){s.off(".dragpan");s.off("mousedown.zoomof");t.attr("src",P[h]);t.css({left:0,top:0,width:p,height:q});u.animate({width:p,height:q,left:0,top:0},100,"linear",function(){u.fadeOut(100)});s.find(".round").fadeIn();s.find(".zoom").fadeIn();s.removeClass("zoomout");S=false}})}}function Y(a,b,c,d,e){var f=window.event;var g=f.touches[0].pageX-c.left;var h=f.touches[0].pageY-c.top;var i=(zoomWidth-p)*-1;var j=(zoomHeight-q)*-1;var k=Math.floor(zoomWidth/p);var l=Math.floor(zoomHeight/q);var m=a-g;var n=b-h;var o=d+m*k*-1;var r=e+n*l*-1;if(o>=0){o=0}if(o<=i){o=i}if(r>=0){r=0}if(r<=j){r=j}u.css("left",o);u.css("top",r);s.on("touchend.zoomendmob",function(){s.off(".mobdragpan");Z=o;_=r})}function ab(b){S=true;var c=true;s.find(".round").fadeOut();a(".zoom").fadeOut();var d=new Image;d.src=Q[h];if(d.complete||d.readystate===4){}else{a(s).find(".zoomload_bg").fadeIn()}d.onload=function(){zoomHeight=d.height;zoomWidth=d.width;var c=(zoomWidth-p)/-2;var e=(zoomHeight-q)/-2;u.attr("src",Q[h]);u.css({left:c,top:e});t.animate({width:zoomWidth,height:zoomHeight,left:c,top:e},100,"linear",function(){u.animate({width:zoomWidth,height:zoomHeight,left:c,top:e},100,"linear",function(){u.fadeIn(100)})});s.find(".zoomload_bg").fadeOut();s.addClass("zoomout");var f=false;s.on("touchstart.dragstartmob",function(){if(typeof Z!=="undefined"){c=Z}if(typeof _!=="undefined"){e=_}var a=window.event;var d=a.touches[0].pageX-b.left;var f=a.touches[0].pageY-b.top;s.on("touchmove.mobdragpan",function(a){a.preventDefault();Y(d,f,b,c,e)})});s.on("click.zoomofmob",function(){if(!f){s.off(".zoomendmob");s.off(".dragstartmob");t.attr("src",P[h]);t.css({left:0,top:0,width:p,height:q});u.animate({width:p,height:q,left:0,top:0},100,"linear",function(){u.fadeOut(100)});a(s).find(".round").fadeIn();a(".zoom").fadeIn();s.removeClass("zoomout");S=false}})}}var d=a.extend({zoom:true,reverse:false,disablelogo:false,startfrom:0,zoomfolder:"zoomimages",pathtophp:"dopelessRotate/scripts/"},c);var e=d.zoom?'<div class="zoom"></div>':"";var f=d.reverse?-1:1;var g=d.disablelogo?"":'<a id="dopeless_rotate_logo" title="Dopeless Rotate Plugin Home" target="_blank" href="http://www.dopeless-design.de/dopeless-rotate-jquery-plugin-360-degrees-product-viewer.html">Dopeless Rotate</a>';var h=d.startfrom;var i=d.startfrom;var j=d.zoomfolder;var k=d.pathtophp;var l=a(this)[0].src;var m=document.createElement("a");m.href=l;var n=m.pathname+m.search;var o=a(this).attr("id");var p=a(this).attr("width");var q=a(this).attr("height");a(this).wrap('<div class="ts_holder" id="holder_'+o+'"/>');var r=a(document);var s=a("#holder_"+o+"");s.html("<img class='ts_img_view' src='' /><img class='ts_imgzoom_view' src='' /><div class='round'><div class='pointer_object'></div><div class='pointer'></div></div>"+e+"<div class='loading_bg'><div class='loading'><p>loading</p><div class='loading_bar'><div class='loading_bar_inside'></div></div></div></div><div class='zoomload_bg'><div class='zoomload_gif'></div></div></div>"+g);var t=a(s).find(".ts_img_view");var u=a(s).find(".ts_imgzoom_view");var v=a(s).find(".round");var w=s.offset();var x=Math.ceil(p/5);var y=Math.ceil(x/10);var z=x/2-y/2-1;var A=x/2-y;var B=x/2-y*2;var C=(x-B)/2;var D=Math.round((p-220)/2);var E=Math.round((q-20)/2);var F=Math.round(p/100*40);var G=72;var H=Math.round((p-F)/2);var I=Math.round((q-G)/2);var J=Math.round(F/100*80);var K=Math.round((F-J)/2);var L=Math.round(G/100*15);var M=J-4;var N;s.bind("dragstart",function(a){a.preventDefault()});s.children().bind("dragstart",function(a){a.preventDefault()});s.css({width:p,height:q});O(".loading_bg, .zoomload_bg",{width:p,height:q});O(".zoomload_gif",{left:D,top:E});O(".loading",{width:F,height:G,left:H,top:I});O(".loading_bar",{width:J,left:K,bottom:L});O(".round",{width:x,height:x});O(".pointer",{width:y,height:y,left:z,top:z*2});O(".zoom",{top:x+x/10+10,right:(x-30)/2-3});O(".pointer_object",{width:B,height:B,left:C,top:C});s.find(".loading_bg").fadeIn();var P;var Q;var R;var S;a.getJSON(k+"/loadimages.php",{fname:n,zoomdir:j},function(a){P=jQuery.makeArray(a.imagelist);Q=jQuery.makeArray(a.zoomlist);R=P.length;T(P,R)});var Z;var _;if(!b){s.on("mousedown.initrotate",function(a){if(!S){var b=a.pageX-w.left;V(b)}});s.find(".zoom").on("click.initzoom",function(a){var b=s.offset();var c=a.pageX-b.left;var d=a.pageY-b.top;X(c,d,b)})}if(b){s.on("touchstart.initrotatemob",function(a){if(!S){a.preventDefault();var b=window.event;var c=b.touches[0].pageX-w.left;W(c)}});s.find(".zoom").on("touchstart.initzoommob",function(a){a.preventDefault();var b=s.offset();ab(b)})}}})(jQuery)